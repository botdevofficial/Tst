<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BotHostify - Authenticated Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">

    <div class="bg-gray-800 p-8 rounded-lg shadow-2xl text-center w-11/12 max-w-md">
        <h1 class="text-2xl font-bold mb-4">Backend Authenticated Test</h1>
        <p class="text-gray-400 mb-6">Enter your backend URL and Secret API Key to test the connection to a protected endpoint.</p>

        <!-- Inputs for Credentials -->
        <div class="space-y-4 mb-6 text-left">
            <div>
                <label for="backend-url" class="block text-sm font-medium text-gray-300 mb-1">Render Backend URL:</label>
                <input type="text" id="backend-url" placeholder="https://your-app-name.onrender.com" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 font-mono">
            </div>
            <div>
                <label for="api-key" class="block text-sm font-medium text-gray-300 mb-1">Secret API Key:</label>
                <input type="password" id="api-key" placeholder="Enter your secret key" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 font-mono">
            </div>
        </div>

        <button id="test-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg w-full transition-all duration-300">
            ▶️ Test Connection
        </button>

        <div id="status-box" class="mt-6 p-4 rounded-lg bg-gray-900 border border-gray-700 min-h-[6rem] flex items-center justify-center">
            <p id="status-text" class="text-gray-500 font-mono">Waiting for test...</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const testButton = document.getElementById('test-button');
            const statusText = document.getElementById('status-text');
            const backendUrlInput = document.getElementById('backend-url');
            const apiKeyInput = document.getElementById('api-key');

            testButton.addEventListener('click', async () => {
                const backendUrl = backendUrlInput.value.trim();
                const apiKey = apiKeyInput.value.trim();
                const registerEndpoint = backendUrl + '/api/register';

                if (!backendUrl || !apiKey) {
                    statusText.textContent = '❌ FAIL: URL and API Key are required.';
                    statusText.className = 'text-red-400 font-mono';
                    return;
                }

                // --- Visual Feedback ---
                statusText.textContent = 'Authenticating...';
                statusText.className = 'text-yellow-400 font-mono animate-pulse';
                testButton.disabled = true;
                testButton.textContent = 'Testing...';

                try {
                    // This fetch call sends the API key in the headers
                    const response = await fetch(registerEndpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Api-Key': apiKey
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.user_id) {
                            // COMPLETE SUCCESS
                            statusText.textContent = '✅ SUCCESS! Connection and authentication OK.';
                            statusText.className = 'text-green-400 font-mono';
                        } else {
                            statusText.textContent = '❌ FAIL: Auth OK, but bad response from backend.';
                            statusText.className = 'text-red-400 font-mono';
                        }
                    } else {
                        // HANDLE SPECIFIC HTTP ERRORS
                        if (response.status === 401) {
                            statusText.textContent = '❌ FAIL (401): Your API Key is incorrect.';
                        } else if (response.status === 404) {
                            statusText.textContent = '❌ FAIL (404): Your Backend URL is incorrect.';
                        } else {
                            statusText.textContent = `❌ FAIL: HTTP Error ${response.status}. Check backend logs.`;
                        }
                        statusText.className = 'text-red-400 font-mono';
                    }

                } catch (error) {
                    // HANDLE NETWORK ERRORS (CORS, DNS, SERVER OFFLINE)
                    console.error('Test failed:', error);
                    statusText.textContent = '❌ FAIL (Network): Could not connect. Check URL, CORS settings, or if backend is running.';
                    statusText.className = 'text-red-400 font-mono';
                } finally {
                    testButton.disabled = false;
                    testButton.textContent = '▶️ Test Connection';
                    statusText.classList.remove('animate-pulse');
                }
            });
        });
    </script>
</body>
</html>

